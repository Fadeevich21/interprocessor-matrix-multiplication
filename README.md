# Межпроцессорное умножение матриц

### Содержание
* [Задание](#задание)
* [Описание](#описание)

## Задание
Необходимо реализовать межпроцессорное умножение матриц с помощью механизма "очередь сообщений" на ОС _Linux_.

## Описание
__Очередь сообщений__ - один из механизмов межпроцессорного взаимодействия. В отличие от каналов (тоже является механизмом межпроцессорного взаимодействия), мы передаём сообщения и запросы, вместо потока байт данных.

Для того, чтобы использовать очередь сообщений в ЯП _C_ в ОС _Linux_, необходимо подключить библиотеку:
```C
#include <sys/msg.h>
```

### Функции для работы с очередью сообщений

[_msgget_](https://man7.org/linux/man-pages/man2/msgget.2.html)

```C
int msgget(key_t key, int msgflg);
```
__Описание__  
Получает идентификатор очереди сообщений

__Параметры__  
* _key_ - уникально идентифицирует очередь сообщений во всей система;
* _msgflg_ - флаги.

__Возвращаемое значение__  
При удачном завершении вызова возвращаемое значение равно нулю. При ошибке возвращается -1, а переменной _errno_ присваивается номер ошибки.

---

[_ftok_](https://man7.org/linux/man-pages/man3/ftok.3.html)

```C
key_t ftok(const char* path, int id);
```
__Описание__  
Преобразовывает имя файла и идентификатор проекта в ключ для системных вызовов/

__Параметры__  
* _path_ - путь к файлу (директиве), к которому у данной программы есть доступ на чтение;
* _id_ - произвольный идентификатор, идентифицирующий очередь сообщений в данной программе.

__Возвращаемое значение__  
В случае удачного завершения вызова возвращается значение созданного ключа _key\_t_. При ошибке возвращается -1, а в переменную _errno_ записывается код ошибки.

---

[_msgsnd_](https://man7.org/linux/man-pages/man3/msgsnd.3p.html)

```C
int msgsnd(int msqid, const void *msgp, size_t msgsz, int msgflg);
```
__Описание__  
Операция отправки сообщения в очередь сообщений.

__Параметры__  
* _msqid_ - дескриптор очереди сообщений;
* _msgp_ - указатель на структуру сообщения;
* _msgsz_ - размер данных сообщения (не включая размер поля типа сообщения);
* _msgflg_ - флаги.

__Возвращаемое значение__  
При ошибке возвращает -1, а переменная _errno_ приобретает соответствующее значение. В противном случае возвращает 0.

---

[_msgrcv_](https://man7.org/linux/man-pages/man3/msgrcv.3p.html)

```C
int msgrcv(int msqid, const void *msgp, size_t msgsz, long msgtyp, int msgflg);
```
__Описание__  
Операция получения сообщения из очереди сообщений.

__Параметры__  
* _msqid_ - дескриптор очереди сообщений;
* _msgp_ - указатель на структуру сообщения;
* _msgsz_ - размер данных сообщения (не включая размер поля типа сообщения);
* _msgtyp_ - ограничивает тип сообщения, которое будет выбрано из очереди;
* _msgflg_ - флаги.

#### Варианты значения параметра _msgtyp_:
| Значение |                        Описание                       |
|:--------:|:-----------------------------------------------------:|
|    0     | При выборе сообщения из очереди его тип игнорируется  |
|   \>0    | Выбирается сообщение с типом _msgtyp_                 |
|   \<0    | Выбирается сообщение с типом меньше ```abs(msgtyp)``` |

__Возвращаемое значение__  
При ошибке возвращает -1, а переменная errno приобретает соответствующее значение. В противном случае возвращает количество байтов, скопированных в массив _mtext_.

---

[_msgctl_](https://man7.org/linux/man-pages/man2/msgctl.2.html)

```C
int msgclt(int msqid, int cmd, struct msqid_ds *buf);
```
__Описание__  
Выполняет операцию, заданную в _cmd_, над очередью сообщений с идентификатором _msqid_.

__Параметры__  
* _msqid_ - дескриптор очереди сообщений;
* _cmd_ - тип выполняемого действия;
* _buf_ - указатель на структуру _msqid\_ds_.

__Возвращаемое значение__  
 При удачном завершении вызова возвращаемое значение равно нулю. При ошибке возвращается -1, а переменной _errno_ присваивается номер ошибки.
 
### Структура сообщений

#### Для отправки сообщения от мастера к рабочему
```C
typedef struct MasterToWorkerActualInfo {
    SizeData index_row;
    SizeData index_column;

    Array row_array;
    Array column_array;
} MasterToWorkerActualInfo;

typedef struct MasterToWorkerMsgInfo {
    long mType;
    MasterToWorkerActualInfo info;
} MasterToWorkerMsgInfo;
```

#### Для отправки сообщения от рабочего к мастеру
``` C
#define MAX_LEN_WORKER_NAME 100

typedef struct WorkerToMasterActualInfo {
    char worker_name[MAX_LEN_WORKER_NAME];
    SizeData index_row;
    SizeData index_column;
    int32_t value;
} WorkerToMasterActualInfo;

typedef struct WorkerToMasterMsgInfo {
    long mType;
    WorkerToMasterActualInfo info;
} WorkerToMasterMsgInfo;
```
